import React, { useState, useEffect } from 'react';
import { Users, Calculator, PieChart, Download, Share2, TrendingUp, Award, Calendar, DollarSign } from 'lucide-react';

export default function GroupCapsuleOpen() {
  const [currentStep, setCurrentStep] = useState(0);
  const [animating, setAnimating] = useState(false);
  const [showImages, setShowImages] = useState(false);

  // ëª¨ì„í˜• íƒ€ì„ìº¡ìŠ ë°ì´í„°
  const capsuleData = {
    title: 'âœˆï¸ ì¹œêµ¬ë“¤ê³¼ ìœ ëŸ½ì—¬í–‰',
    category: 'travel',
    period: '1ë…„',
    startDate: '2025.01.01',
    endDate: '2025.12.31',
    targetAmount: 20000000,
    finalAmount: 21500000,
    achievementRate: 107.5,
    memberCount: 4,
    totalRecords: 96,
    totalExpenses: 2800000,
    members: [
      { 
        id: 'member1', 
        name: 'ì´ì •ì€', 
        avatar: 'ğŸ‘¤', 
        contribution: 5600000, 
        percentage: 26.0,
        rank: 1,
        records: 28,
        isMe: true
      },
      { 
        id: 'member2', 
        name: 'ê¹€í˜œì§„', 
        avatar: 'ğŸ‘©', 
        contribution: 5400000, 
        percentage: 25.1,
        rank: 2,
        records: 25
      },
      { 
        id: 'member3', 
        name: 'ê¹€ìˆ˜ë¦„', 
        avatar: 'ğŸ‘¨', 
        contribution: 5300000, 
        percentage: 24.7,
        rank: 3,
        records: 22
      },
      { 
        id: 'member4', 
        name: 'í•œì§€í˜œ', 
        avatar: 'ğŸ‘©â€ğŸ¦±', 
        contribution: 5200000, 
        percentage: 24.2,
        rank: 4,
        records: 21
      }
    ],
    expenseBreakdown: [
      { category: 'í•­ê³µë£Œ', amount: 8000000, percentage: 37.2, emoji: 'âœˆï¸' },
      { category: 'ìˆ™ë°•ë¹„', amount: 6000000, percentage: 27.9, emoji: 'ğŸ¨' },
      { category: 'ì—¬í–‰ìë³´í—˜', amount: 1200000, percentage: 5.6, emoji: 'ğŸ›¡ï¸' },
      { category: 'ê¸°íƒ€ì¤€ë¹„', amount: 2300000, percentage: 10.7, emoji: 'ğŸ’' },
      { category: 'ì˜ˆë¹„ìê¸ˆ', amount: 4000000, percentage: 18.6, emoji: 'ğŸ’°' }
    ],
    milestones: [
      { date: '2025.03.15', title: 'í•­ê³µë£Œ ì˜ˆì•½ ì™„ë£Œ', amount: '8,000,000ì›', members: 4 },
      { date: '2025.06.20', title: 'ìˆ™ë°• ì˜ˆì•½ ì™„ë£Œ', amount: '6,000,000ì›', members: 4 },
      { date: '2025.09.10', title: 'ëª©í‘œ ê¸ˆì•¡ ë‹¬ì„±', amount: '20,000,000ì›', members: 4 },
      { date: '2025.12.31', title: 'ìµœì¢… ëª©í‘œ ì´ˆê³¼', amount: '21,500,000ì›', members: 4 }
    ],
    groupAchievements: [
      { icon: 'ğŸ†', title: 'íŒ€ì›Œí¬ìƒ', desc: 'ëª©í‘œ 107% ë‹¬ì„±' },
      { icon: 'ğŸ“Š', title: 'íˆ¬ëª…ê²½ì˜ìƒ', desc: '96íšŒ íˆ¬ëª…í•œ ê¸°ë¡' },
      { icon: 'ğŸ’ª', title: 'ê¾¸ì¤€í•¨ìƒ', desc: '1ë…„ê°„ ì§€ì†' },
      { icon: 'âœˆï¸', title: 'ì—¬í–‰ì¤€ë¹„ì™„ë£Œ', desc: 'ëª¨ë“  ì˜ˆì•½ ì™„ë£Œ' }
    ]
  };

  useEffect(() => {
    // 3ì´ˆ í›„ ìë™ìœ¼ë¡œ ë‹¤ìŒ ë‹¨ê³„
    const timer = setTimeout(() => {
      if (currentStep === 0) {
        setCurrentStep(1);
      }
    }, 3000);
    return () => clearTimeout(timer);
  }, [currentStep]);

  const nextStep = () => {
    if (currentStep < 2) {
      setAnimating(true);
      setTimeout(() => {
        setCurrentStep(currentStep + 1);
        setAnimating(false);
      }, 300);
    }
  };

  const toggleImages = () => {
    setShowImages(!showImages);
  };

  const handleShare = () => {
    alert('ğŸ“± ëª¨ì„ ì„±ê³¼ê°€ ê·¸ë£¹ ì±„íŒ…ë°©ì— ê³µìœ ë˜ì—ˆìŠµë‹ˆë‹¤!\nëª¨ë“  ë©¤ë²„ê°€ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”!');
  };

  const handleDownload = () => {
    alert('ğŸ“Š ëª¨ì„ ì •ì‚°ì„œ ë° ìƒì„¸ ë¦¬í¬íŠ¸ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!\nì—¬í–‰ ì¤€ë¹„ ì™„ë£Œ!');
  };

  const myData = capsuleData.members.find(m => m.isMe);

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-100 via-purple-100 to-pink-200 max-w-md mx-auto">
      {/* Step 0: íƒ€ì„ìº¡ìŠ ì—´ê¸° ì• ë‹ˆë©”ì´ì…˜ (ê³µí†µ) */}
      {currentStep === 0 && (
        <div className="min-h-screen flex flex-col items-center justify-center p-6">
          <div className={`transition-all duration-1000 ${animating ? 'opacity-0' : 'opacity-100'}`}>
            {/* ì´ë¯¸ì§€ êµì²´ ë²„íŠ¼ */}
            <button 
              onClick={toggleImages}
              className="w-full mb-6"
            >
              <div className="w-64 h-64 mx-auto bg-gradient-to-br from-blue-200 to-purple-300 rounded-full flex items-center justify-center shadow-xl transform hover:scale-105 transition-transform">
                {showImages ? (
                  <div className="text-center">
                    <div className="text-6xl mb-2">âœˆï¸</div>
                    <div className="text-lg font-bold text-gray-800">ìœ ëŸ½ì—¬í–‰!</div>
                  </div>
                ) : (
                  <div className="text-center">
                    <div className="text-6xl mb-2 animate-bounce">ğŸ¥š</div>
                    <div className="text-lg font-bold text-gray-800">íƒ€ì„ìº¡ìŠ</div>
                  </div>
                )}
              </div>
            </button>

            <div className="text-center bg-white/80 backdrop-blur-sm rounded-2xl p-6 shadow-xl">
              <h1 className="text-2xl font-bold text-gray-800 mb-2">
                ë”°ë€! íƒ€ì„ìº¡ìŠì´ ì—´ë ¸ì–´ìš”! ğŸ‰
              </h1>
              <p className="text-gray-600 mb-4">
                <span className="font-bold text-blue-600">{capsuleData.memberCount}ëª…</span>ì´ 
                <span className="font-bold text-purple-600"> {capsuleData.period}</span>ê°„ 
                í•¨ê»˜í•œ íŠ¹ë³„í•œ ì—¬ì •ì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤
              </p>
              <div className="text-sm text-gray-500">
                {capsuleData.startDate} ~ {capsuleData.endDate}
              </div>
            </div>

            <button 
              onClick={nextStep}
              className="mt-8 w-full bg-gradient-to-r from-blue-400 to-purple-500 text-white py-4 rounded-xl font-bold text-lg shadow-lg"
            >
              ëª¨ì„ ì„±ê³¼ í™•ì¸í•˜ê¸° ğŸ‘¥
            </button>
          </div>
        </div>
      )}

      {/* Step 1: ëª¨ì„ ì„±ê³¼ ë° ë©¤ë²„ë³„ ê¸°ì—¬ë„ */}
      {currentStep === 1 && (
        <div className={`min-h-screen p-4 transition-opacity duration-300 ${animating ? 'opacity-0' : 'opacity-100'}`}>
          <div className="text-center mb-6 pt-8">
            <h2 className="text-2xl font-bold text-gray-800 mb-2">ğŸ‘¥ ëª¨ì„ ì„±ê³¼</h2>
            <p className="text-gray-600">í•¨ê»˜ ì´ë¤„ë‚¸ ë†€ë¼ìš´ ê²°ê³¼</p>
          </div>

          {/* ì „ì²´ ëª©í‘œ ë‹¬ì„± í˜„í™© */}
          <div className="bg-white rounded-xl p-6 shadow-lg mb-6">
            <h3 className="text-lg font-bold text-gray-800 mb-4">ğŸ¯ ì „ì²´ ë‹¬ì„± í˜„í™©</h3>
            
            <div className="space-y-4">
              <div className="flex justify-between items-center">
                <span className="text-gray-600">ëª©í‘œ ê¸ˆì•¡</span>
                <span className="font-bold text-gray-800">{capsuleData.targetAmount.toLocaleString()}ì›</span>
              </div>
              <div className="flex justify-between items-center">
                <span className="text-gray-600">ìµœì¢… ë‹¬ì„±</span>
                <span className="font-bold text-blue-600">{capsuleData.finalAmount.toLocaleString()}ì›</span>
              </div>
              <div className="flex justify-between items-center">
                <span className="text-gray-600">ë‹¬ì„±ë¥ </span>
                <span className="font-bold text-blue-600">{capsuleData.achievementRate}%</span>
              </div>
            </div>

            <div className="mt-4 p-4 bg-blue-50 rounded-lg">
              <div className="text-center">
                <div className="text-2xl font-bold text-blue-600 mb-1">
                  +{(capsuleData.finalAmount - capsuleData.targetAmount).toLocaleString()}ì›
                </div>
                <div className="text-sm text-blue-700">ëª©í‘œ ì´ˆê³¼ ë‹¬ì„±! íŒ€ì›Œí¬ ìµœê³ ! ğŸ‰</div>
              </div>
            </div>
          </div>

          {/* ë©¤ë²„ë³„ ê¸°ì—¬ë„ ìˆœìœ„ */}
          <div className="bg-white rounded-xl p-6 shadow-lg mb-6">
            <h3 className="text-lg font-bold text-gray-800 mb-4">ğŸ† ë©¤ë²„ë³„ ê¸°ì—¬ë„</h3>
            
            <div className="space-y-3">
              {capsuleData.members.map((member, index) => (
                <div key={member.id} className={`flex items-center justify-between p-3 rounded-lg ${
                  member.isMe ? 'bg-blue-50 border-2 border-blue-200' : 'bg-gray-50'
                }`}>
                  <div className="flex items-center space-x-3">
                    <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-white ${
                      member.rank === 1 ? 'bg-yellow-500' : 
                      member.rank === 2 ? 'bg-gray-400' : 
                      member.rank === 3 ? 'bg-orange-600' : 'bg-gray-500'
                    }`}>
                      {member.rank}
                    </div>
                    <span className="text-lg">{member.avatar}</span>
                    <div>
                      <div className="font-medium text-gray-800">
                        {member.name} {member.isMe && '(ë‚˜)'}
                      </div>
                      <div className="text-xs text-gray-500">{member.records}íšŒ ê¸°ë¡</div>
                    </div>
                  </div>
                  <div className="text-right">
                    <div className="font-bold text-gray-800">
                      {member.contribution.toLocaleString()}ì›
                    </div>
                    <div className="text-xs text-gray-500">{member.percentage}%</div>
                  </div>
                </div>
              ))}
            </div>
            
            {myData && (
              <div className="mt-4 p-3 bg-blue-100 rounded-lg">
                <div className="text-center">
                  <div className="font-bold text-blue-800">
                    ë‚˜ì˜ ìˆœìœ„: {myData.rank}ìœ„ ğŸ†
                  </div>
                  <div className="text-sm text-blue-600">
                    ì „ì²´ì˜ {myData.percentage}% ê¸°ì—¬
                  </div>
                </div>
              </div>
            )}
          </div>

          {/* ì£¼ìš” ë§ˆì¼ìŠ¤í†¤ */}
          <div className="bg-white rounded-xl p-6 shadow-lg mb-6">
            <h3 className="text-lg font-bold text-gray-800 mb-4">ğŸ“… ì£¼ìš” ë§ˆì¼ìŠ¤í†¤</h3>
            
            <div className="space-y-3">
              {capsuleData.milestones.map((milestone, index) => (
                <div key={index} className="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                  <div className="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                    <span className="text-white text-xs font-bold">{index + 1}</span>
                  </div>
                  <div className="flex-1">
                    <div className="font-medium text-gray-800">{milestone.title}</div>
                    <div className="text-xs text-gray-500">{milestone.date}</div>
                  </div>
                  <div className="text-right">
                    <div className="font-bold text-green-600">{milestone.amount}</div>
                    <div className="text-xs text-gray-500">ğŸ‘¥ {milestone.members}ëª…</div>
                  </div>
                </div>
              ))}
            </div>
          </div>

          <button 
            onClick={nextStep}
            className="w-full bg-gradient-to-r from-purple-500 to-pink-600 text-white py-4 rounded-xl font-bold shadow-lg"
          >
            ìƒì„¸ ë¶„ì„ ë³´ê¸° ğŸ“Š
          </button>
        </div>
      )}

      {/* Step 2: ìƒì„¸ ë¶„ì„ ë° ì •ì‚° ì •ë³´ */}
      {currentStep === 2 && (
        <div className={`min-h-screen p-4 transition-opacity duration-300 ${animating ? 'opacity-0' : 'opacity-100'}`}>
          <div className="text-center mb-6 pt-8">
            <h2 className="text-2xl font-bold text-gray-800 mb-2">ğŸ“Š ìƒì„¸ ë¶„ì„</h2>
            <p className="text-gray-600">íˆ¬ëª…í•œ ëª¨ì„ ê´€ë¦¬ ê²°ê³¼</p>
          </div>

          {/* ë¹„ìš© êµ¬ì„± ë¶„ì„ */}
          <div className="bg-white rounded-xl p-6 shadow-lg mb-4">
            <h3 className="text-lg font-bold text-gray-800 mb-4">ğŸ’° ë¹„ìš© êµ¬ì„±</h3>
            
            <div className="space-y-3">
              {capsuleData.expenseBreakdown.map((expense, index) => (
                <div key={index} className="flex items-center space-x-3">
                  <span className="text-xl">{expense.emoji}</span>
                  <div className="flex-1">
                    <div className="flex justify-between items-center mb-1">
                      <span className="font-medium text-gray-800">{expense.category}</span>
                      <span className="text-sm font-bold text-blue-600">
                        {expense.amount.toLocaleString()}ì›
                      </span>
                    </div>
                    <div className="w-full bg-gray-200 rounded-full h-2">
                      <div 
                        className="bg-blue-500 h-2 rounded-full transition-all duration-1000"
                        style={{ width: `${expense.percentage}%` }}
                      ></div>
                    </div>
                    <div className="text-xs text-gray-500 mt-1">{expense.percentage}%</div>
                  </div>
                </div>
              ))}
            </div>
          </div>

          {/* ëª¨ì„ ì„±ì·¨ */}
          <div className="bg-white rounded-xl p-6 shadow-lg mb-4">
            <h3 className="text-lg font-bold text-gray-800 mb-4">ğŸ† ëª¨ì„ ì„±ì·¨</h3>
            
            <div className="grid grid-cols-2 gap-3">
              {capsuleData.groupAchievements.map((achievement, index) => (
                <div key={index} className="bg-gradient-to-br from-blue-100 to-purple-100 p-4 rounded-lg text-center">
                  <div className="text-2xl mb-2">{achievement.icon}</div>
                  <div className="font-bold text-gray-800 text-sm">{achievement.title}</div>
                  <div className="text-xs text-gray-600 mt-1">{achievement.desc}</div>
                </div>
              ))}
            </div>
          </div>

          {/* í™œë™ í†µê³„ */}
          <div className="bg-white rounded-xl p-6 shadow-lg mb-4">
            <h3 className="text-lg font-bold text-gray-800 mb-4">ğŸ“ˆ í™œë™ í†µê³„</h3>
            
            <div className="grid grid-cols-3 gap-4">
              <div className="text-center">
                <div className="text-2xl font-bold text-purple-600">{capsuleData.totalRecords}íšŒ</div>
                <div className="text-sm text-gray-600">ì´ ê¸°ë¡</div>
              </div>
              <div className="text-center">
                <div className="text-2xl font-bold text-green-600">{capsuleData.memberCount}ëª…</div>
                <div className="text-sm text-gray-600">ì°¸ì—¬ ë©¤ë²„</div>
              </div>
              <div className="text-center">
                <div className="text-2xl font-bold text-blue-600">{Math.round(capsuleData.totalRecords / capsuleData.memberCount)}</div>
                <div className="text-sm text-gray-600">í‰ê·  ê¸°ë¡</div>
              </div>
            </div>
          </div>

          {/* ìµœì¢… ì •ì‚° ì •ë³´ */}
          <div className="bg-gradient-to-r from-green-100 to-blue-100 rounded-xl p-6 mb-4">
            <h3 className="text-lg font-bold text-gray-800 mb-4">ğŸ’³ ìµœì¢… ì •ì‚°</h3>
            
            <div className="bg-white/60 rounded-lg p-4 mb-3">
              <div className="text-center">
                <div className="text-xl font-bold text-green-600 mb-2">
                  ì •ì‚° ì™„ë£Œ! âœ…
                </div>
                <div className="text-sm text-gray-700">
                  ëª¨ë“  ë©¤ë²„ê°€ ë™ì¼í•˜ê²Œ ê¸°ì—¬í–ˆìŠµë‹ˆë‹¤
                </div>
              </div>
            </div>
            
            <div className="space-y-2 text-sm">
              <div className="flex justify-between">
                <span className="text-gray-700">1ì¸ë‹¹ ìµœì¢… ë¶€ë‹´ê¸ˆ:</span>
                <span className="font-bold text-gray-800">
                  {Math.round(capsuleData.finalAmount / capsuleData.memberCount).toLocaleString()}ì›
                </span>
              </div>
              <div className="flex justify-between">
                <span className="text-gray-700">ì—¬í–‰ ì˜ˆì‚° ì—¬ìœ ë¶„:</span>
                <span className="font-bold text-green-600">
                  {(capsuleData.finalAmount - capsuleData.targetAmount).toLocaleString()}ì›
                </span>
              </div>
            </div>
          </div>

          {/* ì—¬í–‰ ì¤€ë¹„ ì™„ë£Œ */}
          <div className="bg-gradient-to-r from-orange-100 to-pink-100 rounded-xl p-6 mb-6">
            <div className="flex items-center space-x-3 mb-3">
              <span className="text-2xl">âœˆï¸</span>
              <h3 className="text-lg font-bold text-gray-800">ì—¬í–‰ ì¤€ë¹„ ì™„ë£Œ!</h3>
            </div>
            <p className="text-gray-700 mb-4">
              ëª¨ë“  ì˜ˆì•½ì´ ì™„ë£Œë˜ì—ˆê³  ì˜ˆì‚°ë„ ì¶©ë¶„í•´ìš”!<br/>
              ì´ì œ ë– ë‚  ì¼ë§Œ ë‚¨ì•˜ìŠµë‹ˆë‹¤! ğŸ‰
            </p>
            <button className="w-full bg-gradient-to-r from-orange-500 to-pink-500 text-white py-3 rounded-lg font-semibold">
              ìƒˆë¡œìš´ ëª¨ì„ ë§Œë“¤ê¸° âœ¨
            </button>
          </div>

          {/* ê³µìœ  ë° ì €ì¥ ë²„íŠ¼ë“¤ */}
          <div className="grid grid-cols-2 gap-3 mb-6">
            <button 
              onClick={handleShare}
              className="flex items-center justify-center space-x-2 bg-blue-500 text-white py-3 rounded-lg font-semibold"
            >
              <Share2 className="w-5 h-5" />
              <span>ê·¸ë£¹ ê³µìœ </span>
            </button>
            <button 
              onClick={handleDownload}
              className="flex items-center justify-center space-x-2 bg-green-500 text-white py-3 rounded-lg font-semibold"
            >
              <Download className="w-5 h-5" />
              <span>ì •ì‚°ì„œ ì €ì¥</span>
            </button>
          </div>

          {/* í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸° */}
          <button className="w-full bg-gray-100 text-gray-700 py-3 rounded-lg font-semibold">
            í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
          </button>
        </div>
      )}
    </div>
  );
}